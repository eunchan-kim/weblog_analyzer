
<html>

<head>
	<style>
		textarea
		{
			width :100%;
			height: 100%;
			border: 1px solid;
		}
		* h3
		{
			color: #535353;
		}
		* h5
		{
			color: #535353;
		}
	</style>	
</head>
	
<body style="background-Color:#F2F3F7;"topmargin="0" leftmargin="0">
 
<div style="float:left;width:100%;height:15%;background-Color:#7AAAB2">
		<center><h1 style="color:white;">Overview Analysis</h1></center>
</div>

<div style="float:left;width:100%;height:5%;background-Color:#F2F3F7">
		<form style="width:90%; float:left;" action="javascript:send_keyword()" method="POST">
			<input style="width:88%"  type = "text" name="key", id="keyword">
			<input style="width:10%" type= "submit" value="search">
		</form>
		<form style="width:5%;float:left;" METHOD="LINK" action="dashboard">
			<input type="submit" value="analysis">
			
		</form>
		<form style="width:5% float:left; "action="javascript:refresh()" method="POST">
			<input type="submit" value="refresh">
		</form>
</div>

<div style="float:left;width:20%;height:80%;background-Color:#F2F3F7">
	<input type="checkbox" id="resume" value="name"/>Search in this result<br/>		
	
	<div id="call_menu1" style="float:left;clear:right;width:100%;">
	<center><h3>Filter</h3></center>
	</div>
		

		<table id="call_menu_table" class="menu1" style="display:none">
			<tr style="vertical-align:top">
				<td style="padding-left=10px"></td>
				<td style="border-left:2px solid black;text-align:justify"> 
					<form action="javascript:send_keyword()" method="POST">
						<input style="float:right;width:30%;display:none" type="text" id="call_ip_input" name="query">
					</form>
					<div  ><h5 id="call_ip"> -IP </h5></div> 
					<form action="javascript:send_keyword()" method="POST">
						<input style="float:right;width:30%;" type="text" id="call_date_input_2" name="query">
						<input style="float:right;width:30%;" type="text" id="call_date_input_1"name="query">
					</form>
					<div ><h5 id="call_date">-DATE </h5></div>
					<form action="javascript:send_keyword()" method="POST">
						<input style="float:right;width:30%;display:none" type="text" id="call_method_input" name="query">
					</form>
					<div ><h5 id="call_method">-METHOD</h5></div>
					<form action="javascript:send_keyword()" method="POST">
						<input style="float:right;width:30%;display:none" type="text" id="call_uri_input" name="query">
					</form>
					<div ><h5 id="call_uri"> -URI</h5></div>
					<form action="javascript:send_keyword()" method="POST">
						<input style="float:right;width:30%;display:none" type="text" id="call_result_input" name="query">
					</form>
					<div><h5 id="call_result"> -Response Code </h5></div>
					<form action="javascript:send_keyword()" method="POST">
						<input style="float:right;width:30%;display:none" type="text" id="call_byte_length_input" name="query">
					</form>
					<div><h5 id="call_byte_length"> -Byte lengh </h5></div>
					<form action="javascript:send_keyword()" method="POST">
						<input style="float:right;width:30%;display:none" type="text" id="call_user_agent_input" name="query">
					</form>
					<div><h5 id="call_user_agent"> -User agent </h5></div>
					
				</td>
		</table>
	<form>
	<center><input style="width:80%" type="submit" value="Save this rule"></center>
	</form>
	<h3 id='call_basic_rule'>Basic Rules</h3>
		<table id='call_basic_rule_input' style='display:none'>
			<tr style="vertical=align:top">
				<td style="padding-left=10px;"></td>
				<td style="border-left:2px solid black; text-align:justify">
					<a value="basic_1" href="#" onclick="Rule(this.text)">scanning</a>
				<h6></h6>
				<a value="basic_2" href="#" onclick="Rule(this.text)">XSS</a>
				<h6></h6>
					<a value="basic_3" href="#" onclick="Rule(this.text)">SQL INJECTION</a>
				<h6></h6>
				<a value="basic_4" href="#" onclick="Rule(this.text)">Malicious Redirect</a>
		</td>
		</table>
	<h3 id='call_user_rule'>User Rules</h3>
		<table id='call_user_rule_input' style='display:none'>
			<tr style='vertical-align:top'>
				<td style='padding-left=10px'></td>
				<td style='border-left:2px solid black; text-align:justify'>
					<a value="user_1" href="#" onclick="Rule(this.text)">user_rule_1</a>
					<h6></h6>
					<a value="user_2" href="#" onclick="Rule(this.text)">user rule 2</a>
					<h6></h6>
					<a value="user_3" href="#" onclick="Rule(this.text)">user rule 3</a>
		</td>
		</table>
	<h3 id="call_statistics">Statistics</h3>
	<h4 id="statistics_overview">0 events in total0(0.0%)</h4>
	<!--<div style="float:left;">
		<textarea style="width:10px; height:10px;"readonly cols="1" rows="1"></textarea>
	</div>
	<div style="float:left">
		<h4> events in total</h4>
	</div>
	<div style="float:left; clear:right;">
		<textarea style="float:left;clear:right;width:10px; height:10px;"readonly cols="1" rows="1"></textarea>
	</div>-->
		<table id="call_statistics_input" style="display:none">
			<tr style="vertical-align:top">
				<td style="padding-left=10px"></td>
				<td style="border-left:2px solid black;text-align:justify">
			<h5 id="statistics_ip_result">-IP(13)</h5>
			<h5 id="statistics_user_agent_result">-User agent(5)</h5>
			<h5 id="statistics_uri_result">-URI</h5></td>
		</table>
	<!--<h3>Prev</h3> <h4>143.248.235 404</h4>-->
</div>
 
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
<div style="clear:right;float:right;width:80%;height:80%;background-Color:#F2F3F7">
	<textarea id="logs" cols="150" rows="20">
	</textarea>
</div>
  
</body>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>

<script>
	function fill_blank()
	{
		$("#keyword").val("");
		$("#call_uri_input").val("");
		$("#call_ip_input").val("");
		$("#call_date_input_1").val("");
		$("#call_date_input_2").val("");
		$("#call_method_input").val("");
		$("#call_result_input").val("");
		$("#call_byte_length_input").val("");
		$("#call_user_agent_input").val("");
		
	}

	function refresh()
	{
		fill_blank();
		send_keyword();	
	}
	function Rule(a)
	{
		fill_blank();
		if(a == "scanning")
		{
			$("#call_uri_input").val("scripts/setup.php");
		}

		else if (a == 'basic_rule_1')
		{
			b=document.getElementById('call_ip_input');
			b.value='qwerty';
			b.document.getElementById('call_date_input_1');
			b.value='asddd';
		}
		else if (a == "XSS")
		{
			$("#call_uri_input").val("<script");
		}
		else if (a == "Malicious Redirect")
		{
			$("#call_uri_input").val("www");
			$("#call_result_input").val("302");
		}
		else if (a == "SQL INJECTION")
		{
			$("#call_uri_input").val("union");
		}
		send_keyword()
	};
	var result_count = 0;
	var uri_count = 0;
	var ip_count = 0;
	var useragent_count = 0;
	var log_size = 0;
	var percentage = 0;
	

	function redraw(){
		document.getElementById("call_menu_table").style.display="block";}
	function hide(){
		document.getElementById("call_menu_table").style.display="none";
	}
	function display()
	{
		a=document.getElementById("call_menu_table").style.display;
		if( a == "block")
		{
			hide();
		}
		else
		{
			redraw();
		}
	}
	function send_keyword()
    {
    	if( !$("#resume").is(':checked') ){
    		document.cookie="search_id=default; path=/;"
    	}
    	document.getElementById("logs").value = "loading"
        $.post('/parse_data', {text: $("#keyword").val(), ip: $("#call_ip_input").val(), date_from: $("#call_date_input_1").val(), date_to: $("#call_date_input_2").val(), method: $("#call_method_input").val(), uri: $("#call_uri_input").val(), result: $("#call_result_input").val(), byte_length: $("#call_byte_length_input").val(), user_agent: $("#call_user_agent_input").val(), url: document.URL
        }).done(function(msg){
            document.getElementById("logs").value=msg["text"];
            document.cookie="search_id="+msg["search_id"]+"; path=/;";
            result_count = msg["result_count"];
            uri_count = msg["uri_count"];
            ip_count = msg["ip_count"];
            useragent_count = msg["useragent_count"];
            log_size = msg["log_number"];
            percentage = result_count * 100 / Number(log_size)
            percentage = percentage.toFixed(2)
            $("#statistics_overview").html(String(result_count) + " events in total " + String(log_size) + "(" + String(percentage) + "%)");
            $("#statistics_ip_result").html("IP("+String(ip_count)+")");
            $("#statistics_uri_result").html("URI("+String(uri_count)+")");
            $("#statistics_user_agent_result").html("User Agent(" + String(useragent_count)+")");
        }).fail(function(msg){
            alert("server connection failed")
        });     
    }
	$(document).click(function(event) {
    	a=($(event.target)[0].id);
		b=a+"_input";
		if( document.getElementById(b).style.display == "block")
		{
			document.getElementById(b).style.display = "none";
		}
		else if(document.getElementById(b).style.display == "none")
		{
			document.getElementById(b).style.display = "block";
		}
		else
		{

		}
	}
    	);
	$(document).ready(function () {  
				               
				                $('#call_menu1').click(function () {    // 마우스가 올라갈 경우 hover클래스 추가
							              display();	            
									            });
						        });
</script>
</html>
